;! name: LIST
;! entry: list_commands
;! base: 50300
;! deps:
;! abi: os
;! bss: none
;! align: 100

prog_table = 4300

list_commands:
  LDI .prog_table
  STA .arg2
  LDI 0
  STA .res1
lc_next:
  LDA .arg2
  PHA
  LAS
  CPI 0
  JPZ lc_end
  LDA .arg2
  STA .res2
  LDI 0
  STA .num_digits
lc_printchar:
  LDA .num_digits
  CPI 8
  JPZ lc_pad
  LDA .res2
  PHA
  LAS
  CPI 0
  JPZ lc_pad
  STA .char
  ; inline write_char
  LDD .char
  DIC 0
  DIC 64
  DIC 192
  DIC 0
  LDA .res2
  ADI 1
  STA .res2
  LDA .num_digits
  ADI 1
  STA .num_digits
  JMP lc_printchar
lc_pad:
  LDA .num_digits
  CPI 10
  JPZ lc_aftercol
  LDI 32
  STA .char
  ; inline write_char
  LDD .char
  DIC 0
  DIC 64
  DIC 192
  DIC 0
  LDA .num_digits
  ADI 1
  STA .num_digits
  JMP lc_pad
lc_aftercol:
  LDA .res1
  ADI 1
  STA .res1
  CPI 3
  JPZ lc_newline
  JMP lc_advance
lc_newline:
  ; inline newline
  DIS 32
  DIC 0
  DIC 128
  DIC 0
  LDI 0
  STA .res1
lc_advance:
  LDA .arg2
  ADI 10
  STA .arg2
  JMP lc_next
lc_end:
  LDA .res1
  CPI 0
  JPZ lc_done
  ; inline newline
  DIS 32
  DIC 0
  DIC 128
  DIC 0
lc_done:
  RET

