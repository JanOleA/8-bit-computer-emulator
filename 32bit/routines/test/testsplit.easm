;! name: TESTSPLIT
;! entry: main
;! abi: os
;! deps: split, display_number, newline

main.sep = .bss
main.indices_ptr = .bss + 1
main.num_indices = .bss + 2
main.first_string_end = .bss + 3
main.i = .bss + 4
main.start_idx = .bss + 5
main.end_idx = .bss + 6
main.string_length = .bss + 7
__tmp_addr = .bss + 8
__tmp_base = .bss + 9
.text_in = "hello,world,this,is,a,test"

  JMP main

main:
  LDI 44
  STA .main.sep
  LDI .text_in
  PHA
  LDA .main.sep
  PHA
  JSR @split
  PLA
  STA .main.indices_ptr
  PLA
  STA .main.num_indices
  LDA .main.num_indices
  PHA
  JSR @display_number
  JSR @newline
  JSR @newline
  LDA .main.indices_ptr
  STA .__tmp_base
  STA .__tmp_addr
  LPA .__tmp_addr                ; pointer element load
  STA .main.first_string_end
  LDI .text_in
  STA .arg1
  LDI 0
  STA .arg2
  LDA .main.first_string_end
  STA .num_digits
  JSR @echon
  LDI 0
  STA .main.i
MAIN__WHILE_START_1:
  LDA .main.num_indices
  CPI 0
  JPZ MAIN__WHILE_END_2
  LDA .main.indices_ptr
  STA .__tmp_base
  LDA .main.i
  ADD .__tmp_base
  STA .__tmp_addr
  LPA .__tmp_addr                ; pointer element load
  STA .main.start_idx
  LDA .main.num_indices
  SUI 1
  CPI 0
  JPZ MAIN__ELSE_4
  LDA .main.indices_ptr
  STA .__tmp_base
  LDA .main.i
  ADI 1
  ADD .__tmp_base
  STA .__tmp_addr
  LPA .__tmp_addr                ; pointer element load
  STA .main.end_idx
  JMP MAIN__ENDIF_3
MAIN__ELSE_4:
  LDI 26
  STA .main.end_idx
MAIN__ENDIF_3:
  LDA .main.end_idx
  SUB .main.start_idx
  SUI 1
  STA .main.string_length
  LDI .text_in
  ADD .main.start_idx
  ADI 1
  STA .arg1
  LDI 0
  STA .arg2
  LDA .main.string_length
  STA .num_digits
  JSR @echon
  LDA .main.i
  ADI 1
  STA .main.i
  LDA .main.num_indices
  SUI 1
  STA .main.num_indices
  JMP MAIN__WHILE_START_1
MAIN__WHILE_END_2:
  RET

