meta name = TESTSPLIT
meta entry = main
meta abi = os

data text_in = "hello,world,this,is,a,test"

func print_substring(start_idx, end_idx):
    let string_length = end_idx - start_idx
    call @print(text_in + start_idx, 0, string_length)

func main:
    let sep = 44  # ASCII code for comma ','
    call @split(text_in, sep) -> indices_ptr, num_indices

    # indices_ptr now points to an array of start indices of substrings in text_in
    # num_indices contains the number of such substrings
    
    # Display the number of indices found
    call @display_number(num_indices)
    call @newline()
    call @newline()
    
    let first_string_end = indices_ptr[0]

    call print_substring(0, first_string_end)

    let i = 0
    while num_indices:
        # Load the start index of the current substring, including the separator (from the start of text_in)
        let start_idx = indices_ptr[i]
        if num_indices != 1:
            let end_idx = indices_ptr[i + 1]
        else:
            let end_idx = 26

        # Print the substring between start_idx and end_idx
        call print_substring(start_idx + 1, end_idx)

        # Move to the next index
        let i += 1
        let num_indices = num_indices - 1

    return
