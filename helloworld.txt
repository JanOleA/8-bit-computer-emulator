char = 255
loopval = 254
textloc = 253
text = 240

.textloc  = 240
.text      = "Hello there"

start:
  LDI 53
  STA .loopval
  DIS 1                 ; clear display
  JSR instruction
  DIS 15                ; set on, display cursor, cursor blink
  JSR instruction

helloworld:

printloop:
  JSR get_next_char
  CPI 0
  JPZ end_printloop
  JSR write_char
  JMP printloop
end_printloop:
  LDI 240
  STA .textloc
  LDA .loopval
  CPI 0
  JPZ end_loop
loop:
  LDI 32                ; space
  STA .char
  JSR write_char
  LDA .loopval
  SUI 1
  STA .loopval
  JPZ helloworld
  JMP loop
end_loop:
  HLT

get_next_char:  ; gets the next character from .textloc and increases .textloc by 1
  LDA .textloc
  PHA
  ADI 1
  STA .textloc
  LAS         ; get the value from .textloc into A
  STA .char
  RET

write_char:
  LDD .char
  DIC 0
  DIC 64      ; set read
  DIC 192     ; set read + enable
  DIC 0
  RET

instruction:
  DIC 0
  DIC 128     ; set enable
  DIC 0
  RET